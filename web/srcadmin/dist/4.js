(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"+Dyb":function(t,a,e){"use strict";e.r(a);var n={name:"DetailField",props:["component"]},i=e("KHd+"),o=Object(i.a)(n,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e(t.component.component,{tag:"component",attrs:{field:t.component.field,props:t.component.props,label:t.component.label},model:{value:t.component.value,callback:function(a){t.$set(t.component,"value",a)},expression:"component.value"}})],1)}),[],!1,null,"5fef3ade",null);a.default=o.exports},jAuM:function(t,a,e){"use strict";e.r(a);var n=e("LvDl"),i=e("+Dyb"),o={name:"Detail",props:{id:[String,Number],defaultFormData:Object,saveUrl:String,detailComponents:Array,additionalComponents:Array,component:void 0,item:Object},components:{DetailField:i.default},created:function(){var t=this;Object(n.each)(this.detailComponents,(function(a){t.formData[a.field]=a})),this.$forceUpdate()},computed:{componentsIndex:function(){var t={};return Object(n.each)(this.detailComponents,(function(a){t[a.field]=a})),t},listUrl:function(){return this.saveUrl.replace("detail","list")},deleteUrl:function(){return this.saveUrl.replace("detail","delete")}},data:function(){return{isSuccess:!1,isError:!1,alertMessage:"",formData:{}}},methods:{checkInput:function(){console.log("input")},back:function(){location.href=this.listUrl+"?list=on"},save:function(){var t=this;this.uploadToServer((function(){t.back()}))},apply:function(){this.uploadToServer()},processError:function(t){var a="";Object(n.each)(t,(function(t){a+=t+"<br>"})),this.alert(a,"error"),$("html, body").animate({scrollTop:0},"slow")},deleteItem:function(){var t=this;confirm("Вы уверены?")&&(this.$root.startProgress(),$.ajax({method:"POST",url:this.saveUrl,data:{id:this.id,delete:!0}}).done((function(a){a.result?t.back():t.alert("Ошибка удаления","error"),t.$root.stopProgress()})).fail((function(){t.$root.stopProgress()})))},alert:function(t,a){this.isError=!1,this.isSuccess=!1,"success"===a?this.isSuccess=!0:this.isError=!0,this.alertMessage=t,this.$forceUpdate()},addAdditionalData:function(t,a){this.additionalComponents[t].dataConfig.push(Object(n.cloneDeep)(a)),this.$forceUpdate()},deleteAdditionalData:function(t,a){this.additionalComponents[t].dataConfig.splice(a,1),this.$forceUpdate()},appendAdditionalData:function(t){var a={};return Object(n.each)(this.additionalComponents,(function(t){a[t.relationClass]||(a[t.relationClass]=[]),Object(n.each)(t.dataConfig,(function(e){var i={};Object(n.each)(e,(function(t){i[t.field]=t.value})),a[t.relationClass].push(i)}))})),t.secondary_form=a,t},uploadToServer:function(t){var a=this;this.$root.startProgress();var e={};this.id&&(e.id=this.id),Object(n.each)(this.formData,(function(t){e[t.field]=t.value})),Object(n.each)(this.defaultFormData,(function(t,a){e[a]=t})),this.item.id&&(e=this.appendAdditionalData(e)),$.ajax({method:"POST",url:this.saveUrl,data:e}).done((function(e){e.result?t?t():location.href=a.saveUrl+"?id="+e.model.id:a.processError(e.errors),a.$root.stopProgress()})).fail((function(){a.$root.stopProgress()}))}}},s=e("KHd+"),r=Object(s.a)(o,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",[e("button",{staticClass:"btn btn-default",on:{click:t.back}},[e("i",{staticClass:"fa fa-arrow-left"}),t._v("\n            Назад\n        ")])]),t._v(" "),e("hr"),t._v(" "),t.alertMessage?e("div",{class:{alert:1,"alert-success":t.isSuccess,"alert-danger":t.isError}},[e("div",{domProps:{innerHTML:t._s(t.alertMessage)}})]):t._e(),t._v(" "),e("p",[t._v(" ")]),t._v(" "),e("ul",{staticClass:"nav nav-tabs"},[t._m(0),t._v(" "),t.additionalComponents&&t.item.id?t._l(t.additionalComponents,(function(a){return e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link",attrs:{"data-toggle":"tab",href:"#"+a.tab}},[t._v(t._s(a.tab))])])})):t._e()],2),t._v(" "),e("div",{staticClass:"tab-content"},[e("p",[t._v(" ")]),t._v(" "),e("div",{staticClass:"tab-pane fade active in",attrs:{id:"description"}},[e("div",{staticClass:"form"},[t._t("default",[t._l(t.formData,(function(t,a){return[e("div",{staticClass:"form-row"},[e("detail-field",{key:"main_data_field"+a,attrs:{component:t}})],1)]}))],{default:t.formData})],2)]),t._v(" "),t.additionalComponents&&t.item.id?t._l(t.additionalComponents,(function(a,n){return e("div",{staticClass:"tab-pane fade",attrs:{id:a.tab}},["one.to.one"!==a.type?e("div",[t._l(a.dataConfig,(function(a,i){return e("div",[e("p",[t._v(" ")]),t._v(" "),e("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(a){return t.deleteAdditionalData(n,i)}}},[t._v("Удалить")]),t._v(" "),t._l(a,(function(t,a){return[e("div",{staticClass:"form-row"},[e("detail-field",{key:"data_component"+a,attrs:{component:t}})],1)]}))],2)})),t._v(" "),e("hr"),t._v(" "),e("button",{staticClass:"btn btn-primary",staticStyle:{"margin-top":"10px"},attrs:{type:"button"},on:{click:function(e){return t.addAdditionalData(n,a.initialConfig)}}},[t._v("Добавить")])],2):e("div",t._l(a.dataConfig,(function(a){return e("div",[t._l(a,(function(t,a){return[e("div",{staticClass:"form-row"},[e("detail-field",{key:"data_component"+a,attrs:{component:t}})],1)]}))],2)})),0)])})):t._e()],2),t._v(" "),e("p",[t._v(" ")]),t._v(" "),e("p",[t._v(" ")]),t._v(" "),e("div",[e("button",{staticClass:"btn btn-success",on:{click:t.save}},[e("i",{staticClass:"fa fa-save"}),t._v("\n            Сохранить\n        ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",on:{click:t.apply}},[t._v("\n            Применить\n        ")]),t._v(" "),this.id?e("button",{staticClass:"btn btn-danger",on:{click:t.deleteItem}},[t._v("\n            Удалить\n        ")]):t._e()]),t._v(" "),e("p",[t._v(" ")]),t._v(" "),e("p",[t._v(" ")]),t._v(" "),e("p",[t._v(" ")]),t._v(" "),e("p",[t._v(" ")])])}),[function(){var t=this.$createElement,a=this._self._c||t;return a("li",{staticClass:"nav-item active"},[a("a",{staticClass:"nav-link active",attrs:{"data-toggle":"tab",href:"#description"}},[this._v("Основное")])])}],!1,null,"24eb79fd",null);a.default=r.exports}}]);
//# sourceMappingURL=4.js.map